// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --function-signature
// RUN: %clang_cc1 -verify -fompss-2 -disable-llvm-passes -ferror-limit 100 %s -S -emit-llvm -o - | FileCheck %s
// expected-no-diagnostics

#define N 4

#pragma oss task out( { p[i][j], i = init1:ub1:step1, j =init2:ub2:step2 } )
// CHECK-LABEL: define {{[^@]+}}@gen
// CHECK-SAME: (ptr noundef [[P:%.*]], i32 noundef [[INIT1:%.*]], i32 noundef [[UB1:%.*]], i32 noundef [[STEP1:%.*]], i32 noundef [[INIT2:%.*]], i32 noundef [[UB2:%.*]], i32 noundef [[STEP2:%.*]]) #[[ATTR0:[0-9]+]] !dbg [[DBG5:![0-9]+]] {
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[P_ADDR:%.*]] = alloca ptr, align 8
// CHECK-NEXT:    [[INIT1_ADDR:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[UB1_ADDR:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[STEP1_ADDR:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[INIT2_ADDR:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[UB2_ADDR:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[STEP2_ADDR:%.*]] = alloca i32, align 4
// CHECK-NEXT:    store ptr [[P]], ptr [[P_ADDR]], align 8
// CHECK-NEXT:    store i32 [[INIT1]], ptr [[INIT1_ADDR]], align 4
// CHECK-NEXT:    store i32 [[UB1]], ptr [[UB1_ADDR]], align 4
// CHECK-NEXT:    store i32 [[STEP1]], ptr [[STEP1_ADDR]], align 4
// CHECK-NEXT:    store i32 [[INIT2]], ptr [[INIT2_ADDR]], align 4
// CHECK-NEXT:    store i32 [[UB2]], ptr [[UB2_ADDR]], align 4
// CHECK-NEXT:    store i32 [[STEP2]], ptr [[STEP2_ADDR]], align 4
// CHECK-NEXT:    ret void, !dbg [[DBG9:![0-9]+]]
//
void gen(int (*p)[N], int init1, int ub1, int step1, int init2, int ub2, int step2) {}

// CHECK-LABEL: define {{[^@]+}}@main
// CHECK-SAME: () #[[ATTR0]] !dbg [[DBG10:![0-9]+]] {
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[M:%.*]] = alloca [4 x [4 x i32]], align 16
// CHECK-NEXT:    [[CALL_ARG:%.*]] = alloca ptr, align 8
// CHECK-NEXT:    [[CALL_ARG1:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG2:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG3:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG4:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG5:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG6:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[I_CALL_ARG:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[J_CALL_ARG:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG7:%.*]] = alloca ptr, align 8
// CHECK-NEXT:    [[CALL_ARG9:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG10:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG11:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG12:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG13:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[CALL_ARG14:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[I_CALL_ARG15:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[J_CALL_ARG16:%.*]] = alloca i32, align 4
// CHECK-NEXT:    [[ARRAYDECAY:%.*]] = getelementptr inbounds [4 x [4 x i32]], ptr [[M]], i64 0, i64 0, !dbg [[DBG11:![0-9]+]]
// CHECK-NEXT:    store ptr [[ARRAYDECAY]], ptr [[CALL_ARG]], align 8, !dbg [[DBG11]]
// CHECK-NEXT:    store i32 0, ptr [[CALL_ARG1]], align 4, !dbg [[DBG12:![0-9]+]]
// CHECK-NEXT:    store i32 3, ptr [[CALL_ARG2]], align 4, !dbg [[DBG13:![0-9]+]]
// CHECK-NEXT:    store i32 1, ptr [[CALL_ARG3]], align 4, !dbg [[DBG14:![0-9]+]]
// CHECK-NEXT:    store i32 0, ptr [[CALL_ARG4]], align 4, !dbg [[DBG15:![0-9]+]]
// CHECK-NEXT:    store i32 3, ptr [[CALL_ARG5]], align 4, !dbg [[DBG16:![0-9]+]]
// CHECK-NEXT:    store i32 1, ptr [[CALL_ARG6]], align 4, !dbg [[DBG17:![0-9]+]]
// CHECK-NEXT:    [[TMP0:%.*]] = call token @llvm.directive.region.entry() [ "DIR.OSS"([5 x i8] c"TASK\00"), "QUAL.OSS.PRIVATE"(ptr [[I_CALL_ARG]], i32 undef), "QUAL.OSS.PRIVATE"(ptr [[J_CALL_ARG]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG]], ptr undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG1]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG2]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG3]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG4]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG5]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG6]], i32 undef), "QUAL.OSS.MULTIDEP.RANGE.OUT"(ptr [[I_CALL_ARG]], ptr [[J_CALL_ARG]], ptr @compute_dep, ptr [[I_CALL_ARG]], ptr [[CALL_ARG1]], ptr [[CALL_ARG2]], ptr [[CALL_ARG3]], ptr [[J_CALL_ARG]], ptr [[CALL_ARG4]], ptr [[CALL_ARG5]], ptr [[CALL_ARG6]], ptr [[CALL_ARG]], [53 x i8] c"{ p[i][j], i = init1:ub1:step1, j =init2:ub2:step2 }\00", ptr @compute_dep.1, ptr [[CALL_ARG]], ptr [[I_CALL_ARG]], ptr [[J_CALL_ARG]], ptr [[CALL_ARG1]], ptr [[CALL_ARG4]], ptr [[CALL_ARG2]], ptr [[CALL_ARG5]], ptr [[CALL_ARG3]], ptr [[CALL_ARG6]]), "QUAL.OSS.DECL.SOURCE"([8 x i8] c"gen:7:9\00") ], !dbg [[DBG18:![0-9]+]]
// CHECK-NEXT:    [[TMP1:%.*]] = load ptr, ptr [[CALL_ARG]], align 8, !dbg [[DBG11]]
// CHECK-NEXT:    [[TMP2:%.*]] = load i32, ptr [[CALL_ARG1]], align 4, !dbg [[DBG12]]
// CHECK-NEXT:    [[TMP3:%.*]] = load i32, ptr [[CALL_ARG2]], align 4, !dbg [[DBG13]]
// CHECK-NEXT:    [[TMP4:%.*]] = load i32, ptr [[CALL_ARG3]], align 4, !dbg [[DBG14]]
// CHECK-NEXT:    [[TMP5:%.*]] = load i32, ptr [[CALL_ARG4]], align 4, !dbg [[DBG15]]
// CHECK-NEXT:    [[TMP6:%.*]] = load i32, ptr [[CALL_ARG5]], align 4, !dbg [[DBG16]]
// CHECK-NEXT:    [[TMP7:%.*]] = load i32, ptr [[CALL_ARG6]], align 4, !dbg [[DBG17]]
// CHECK-NEXT:    call void @gen(ptr noundef [[TMP1]], i32 noundef [[TMP2]], i32 noundef [[TMP3]], i32 noundef [[TMP4]], i32 noundef [[TMP5]], i32 noundef [[TMP6]], i32 noundef [[TMP7]]), !dbg [[DBG18]]
// CHECK-NEXT:    call void @llvm.directive.region.exit(token [[TMP0]]), !dbg [[DBG18]]
// CHECK-NEXT:    [[ARRAYDECAY8:%.*]] = getelementptr inbounds [4 x [4 x i32]], ptr [[M]], i64 0, i64 0, !dbg [[DBG19:![0-9]+]]
// CHECK-NEXT:    store ptr [[ARRAYDECAY8]], ptr [[CALL_ARG7]], align 8, !dbg [[DBG19]]
// CHECK-NEXT:    store i32 0, ptr [[CALL_ARG9]], align 4, !dbg [[DBG20:![0-9]+]]
// CHECK-NEXT:    store i32 3, ptr [[CALL_ARG10]], align 4, !dbg [[DBG21:![0-9]+]]
// CHECK-NEXT:    store i32 1, ptr [[CALL_ARG11]], align 4, !dbg [[DBG22:![0-9]+]]
// CHECK-NEXT:    store i32 0, ptr [[CALL_ARG12]], align 4, !dbg [[DBG23:![0-9]+]]
// CHECK-NEXT:    store i32 3, ptr [[CALL_ARG13]], align 4, !dbg [[DBG24:![0-9]+]]
// CHECK-NEXT:    store i32 1, ptr [[CALL_ARG14]], align 4, !dbg [[DBG25:![0-9]+]]
// CHECK-NEXT:    [[TMP8:%.*]] = call token @llvm.directive.region.entry() [ "DIR.OSS"([5 x i8] c"TASK\00"), "QUAL.OSS.PRIVATE"(ptr [[I_CALL_ARG15]], i32 undef), "QUAL.OSS.PRIVATE"(ptr [[J_CALL_ARG16]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG7]], ptr undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG9]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG10]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG11]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG12]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG13]], i32 undef), "QUAL.OSS.FIRSTPRIVATE"(ptr [[CALL_ARG14]], i32 undef), "QUAL.OSS.MULTIDEP.RANGE.OUT"(ptr [[I_CALL_ARG15]], ptr [[J_CALL_ARG16]], ptr @compute_dep.2, ptr [[I_CALL_ARG15]], ptr [[CALL_ARG9]], ptr [[CALL_ARG10]], ptr [[CALL_ARG11]], ptr [[J_CALL_ARG16]], ptr [[CALL_ARG12]], ptr [[CALL_ARG13]], ptr [[CALL_ARG14]], ptr [[CALL_ARG7]], [53 x i8] c"{ p[i][j], i = init1:ub1:step1, j =init2:ub2:step2 }\00", ptr @compute_dep.3, ptr [[CALL_ARG7]], ptr [[I_CALL_ARG15]], ptr [[J_CALL_ARG16]], ptr [[CALL_ARG9]], ptr [[CALL_ARG12]], ptr [[CALL_ARG10]], ptr [[CALL_ARG13]], ptr [[CALL_ARG11]], ptr [[CALL_ARG14]]), "QUAL.OSS.DECL.SOURCE"([8 x i8] c"gen:7:9\00") ], !dbg [[DBG26:![0-9]+]]
// CHECK-NEXT:    [[TMP9:%.*]] = load ptr, ptr [[CALL_ARG7]], align 8, !dbg [[DBG19]]
// CHECK-NEXT:    [[TMP10:%.*]] = load i32, ptr [[CALL_ARG9]], align 4, !dbg [[DBG20]]
// CHECK-NEXT:    [[TMP11:%.*]] = load i32, ptr [[CALL_ARG10]], align 4, !dbg [[DBG21]]
// CHECK-NEXT:    [[TMP12:%.*]] = load i32, ptr [[CALL_ARG11]], align 4, !dbg [[DBG22]]
// CHECK-NEXT:    [[TMP13:%.*]] = load i32, ptr [[CALL_ARG12]], align 4, !dbg [[DBG23]]
// CHECK-NEXT:    [[TMP14:%.*]] = load i32, ptr [[CALL_ARG13]], align 4, !dbg [[DBG24]]
// CHECK-NEXT:    [[TMP15:%.*]] = load i32, ptr [[CALL_ARG14]], align 4, !dbg [[DBG25]]
// CHECK-NEXT:    call void @gen(ptr noundef [[TMP9]], i32 noundef [[TMP10]], i32 noundef [[TMP11]], i32 noundef [[TMP12]], i32 noundef [[TMP13]], i32 noundef [[TMP14]], i32 noundef [[TMP15]]), !dbg [[DBG26]]
// CHECK-NEXT:    call void @llvm.directive.region.exit(token [[TMP8]]), !dbg [[DBG26]]
// CHECK-NEXT:    ret i32 0, !dbg [[DBG27:![0-9]+]]
//
int main() {
    int M[N][N];
    gen(M, 0, N-1, 1, 0, N-1, 1);
    gen(M, 0, N-1, 1, 0, N-1, 1);
}




